# Update translations
function #game:language

######################
# Shop related stuff #
######################

data modify storage minecraft:shop Template set value [{Slot: 0b, id: "minecraft:wooden_sword", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x5 Iron","color":"white","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"item.minecraft.wooden_sword","color":"green","italic":false}'}, Damage: 0}}, {Slot: 1b, id: "minecraft:stone_sword", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x27 Iron","color":"white","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"item.minecraft.stone_sword","color":"green","italic":false}'}, Damage: 0}}, {Slot: 2b, id: "minecraft:iron_sword", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x6 Gold","color":"gold","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"item.minecraft.iron_sword","color":"green","italic":false}'}, Damage: 0}}, {Slot: 3b, id: "minecraft:golden_sword", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"translate":"enchantment.minecraft.knockback","color":"gray","italic":false},{"text":" I","color":"gray","italic":false}]', '[{"text":"Price: ","color":"gray","italic":false},{"text":"x4 Ruby","color":"red","italic":false}]', '{"text":""}', '{"text":"§e▶ Click here to buy"}'], Name: '{"translate":"item.minecraft.golden_sword","color":"green","italic":false}'}, Enchantments: [{lvl: 1s, id: "minecraft:knockback"}], Damage: 0}}, {Slot: 4b, id: "minecraft:potion", Count: 1b, tag: {shop: 1b, HideFlags: 127, Potion: "minecraft:strength", display: {Lore: ['{"text":"Kills you when used","color":"gray","italic":false}', '[{"text":"Price: ","color":"gray","italic":false},{"text":"x3 Ruby","color":"red","italic":false}]', '{"text":""}', '{"text":"§e▶ Click here to buy"}'], Name: '{"text":"Explosive Potion","color":"green","italic":false}'}}}, {Slot: 5b, id: "minecraft:black_stained_glass_pane", Count: 1b, tag: {shop: 1b, display: {Name: '{"text":""}'}}}, {Slot: 6b, id: "minecraft:stone_pickaxe", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x32 Iron","color":"white","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"item.minecraft.stone_pickaxe","color":"green","italic":false}'}, Enchantments: [{lvl: 1, id: "minecraft:sharpness"}], Damage: 0}}, {Slot: 7b, id: "minecraft:iron_pickaxe", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x8 Gold","color":"gold","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"item.minecraft.iron_pickaxe","color":"green","italic":false}'}, Enchantments: [{lvl: 1, id: "minecraft:sharpness"}], Damage: 0}}, {Slot: 8b, id: "minecraft:diamond_pickaxe", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x2 Ruby","color":"red","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"item.minecraft.diamond_pickaxe","color":"green","italic":false}'}, Enchantments: [{lvl: 1, id: "minecraft:sharpness"}], Damage: 0}}, {Slot: 9b, id: "minecraft:chainmail_boots", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x4 Gold","color":"gold","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"text":"Permanent chainmail armor","color":"dark_purple","italic":false}'}, Damage: 0}}, {Slot: 10b, id: "minecraft:iron_boots", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x16 Gold","color":"gold","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"text":"Permanent iron armor","color":"dark_purple","italic":false}'}, Damage: 0}}, {Slot: 11b, id: "minecraft:diamond_boots", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x8 Ruby","color":"red","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"text":"Permanent diamond armor","color":"dark_purple","italic":false}'}, Damage: 0}}, {Slot: 12b, id: "minecraft:elytra", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x6 Ruby","color":"red","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"text":"Permanent elytra","color":"dark_purple","italic":false}'}, Damage: 0}}, {Slot: 13b, id: "minecraft:firework_rocket", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x2 Ruby","color":"red","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"item.minecraft.firework_rocket","color":"green","italic":false}'}}}, {Slot: 14b, id: "minecraft:black_stained_glass_pane", Count: 1b, tag: {shop: 1b, display: {Name: '{"text":""}'}}}, {Slot: 16b, id: "minecraft:end_stone", Count: 5b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x2 Gold","color":"gold","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"block.minecraft.end_stone","color":"green","italic":false}'}}}, {Slot: 17b, id: "minecraft:obsidian", Count: 3b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x4 Ruby","color":"red","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"block.minecraft.obsidian","color":"green","italic":false}'}}}, {Slot: 18b, id: "minecraft:bow", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x10 Gold","color":"gold","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"item.minecraft.bow","color":"green","italic":false}'}, Enchantments: [{lvl: 1, id: "minecraft:sharpness"}], Damage: 0}}, {Slot: 19b, id: "minecraft:bow", Count: 1b, tag: {HideFlags: 127, display: {Lore: ['[{"translate":"enchantment.minecraft.punch","color":"gray","italic":false},{"text":" I","color":"gray","italic":false}]', '[{"translate":"enchantment.minecraft.power","color":"gray","italic":false},{"text":" I","color":"gray","italic":false}]', '[{"text":"Price: ","color":"gray","italic":false},{"text":"x6 Ruby","color":"red","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"text":"Super bow","color":"green","italic":false}'}, Enchantments: [{id: "minecraft:sharpness"}], Damage: 0, shop1: 1b}}, {Slot: 20b, id: "minecraft:arrow", Count: 8b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x3 Gold","color":"gold","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"item.minecraft.arrow","color":"green","italic":false}'}}}, {Slot: 21b, id: "minecraft:fishing_rod", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x18 Iron","color":"white","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"item.minecraft.fishing_rod","color":"green","italic":false}'}, Damage: 0}}, {Slot: 22b, id: "minecraft:ender_pearl", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x3 Ruby","color":"red","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"item.minecraft.ender_pearl","color":"green","italic":false}'}}}, {Slot: 23b, id: "minecraft:black_stained_glass_pane", Count: 1b, tag: {shop: 1b, display: {Name: '{"text":""}'}}}, {Slot: 24b, id: "minecraft:golden_axe", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x2 Ruby","color":"red","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"text":"Permanent Axe","color":"dark_purple","italic":false}'}, Enchantments: [{lvl: 1, id: "minecraft:sharpness"}], Damage: 0}}, {Slot: 25b, id: "minecraft:oak_planks", Count: 16b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x20 Iron","color":"white","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"block.minecraft.oak_planks","color":"green","italic":false}'}}}, {Slot: 26b, id: "minecraft:cobweb", Count: 1b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x8 Iron","color":"white","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"block.minecraft.cobweb","color":"green","italic":false}'}}}]
data modify storage minecraft:shop YellowGlass set value {Slot: 15b, id: "minecraft:yellow_stained_glass", Count: 16b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x4 Iron","color":"white","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"block.minecraft.yellow_stained_glass","color":"green","italic":false}'}}}
data modify storage minecraft:shop BlueGlass set value {Slot: 15b, id: "minecraft:light_blue_stained_glass", Count: 16b, tag: {shop: 1b, HideFlags: 127, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"x4 Iron","color":"white","italic":false}]', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"translate":"block.minecraft.light_blue_stained_glass","color":"green","italic":false}'}}}

data modify storage minecraft:upgrader Template set value [{Slot: 0b, id: "minecraft:emerald", Count: 1b, tag: {HideFlags: 127, U: 1, Up: true, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"1 Soul ","color":"aqua","italic":false}]', '{"text":""}', '{"text":"+1 ❤ for Shulker","color":"gray","italic":false}', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"color":"green","italic":false,"text":"Shulker"}'}}}, {Slot: 1b, id: "minecraft:golden_carrot", Count: 1b, tag: {HideFlags: 127, U: 1, Up: true, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"3 Souls ","color":"aqua","italic":false}]', '{"text":""}', '{"text":"+ Mining fatigue to enemies","color":"gray","italic":false}', '{"text":"around your Shulker","color":"gray","italic":false}', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"color":"green","italic":false,"text":"Magic effects I"}'}}}, {Slot: 2b, id: "minecraft:iron_sword", Count: 1b, tag: {HideFlags: 127, U: 1, Up: 1b, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"4 Souls ","color":"aqua","italic":false}]', '{"text":""}', '{"text":"+ Sharpness I","color":"gray","italic":false}', '{"text":"for swords","color":"gray","italic":false}', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"color":"green","italic":false,"text":"Armor enchantment I"}'}}}, {Slot: 3b, id: "minecraft:iron_chestplate", Count: 1b, tag: {HideFlags: 127, U: 1, Up: true, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"4 Souls ","color":"aqua","italic":false}]', '{"text":""}', '{"text":"+ Protection I","color":"gray","italic":false}', '{"text":"for armor","color":"gray","italic":false}', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"color":"green","italic":false,"text":"Weapon enchantment I"}'}}}, {Slot: 4b, id: "minecraft:brewing_stand", Count: 1b, tag: {HideFlags: 127, U: 1, Up: true, display: {Lore: ['[{"text":"Price: ","color":"gray","italic":false},{"text":"2 Souls ","color":"aqua","italic":false}]', '{"text":""}', '{"text":"+ 33% resources","color":"gray","italic":false}', '{"text":"in Generator","color":"gray","italic":false}', '{"text":""}', '{"text":"▶ Click here to buy","color":"yellow","italic":false}'], Name: '{"color":"green","italic":false,"text":"Forge upgrade I"}'}}}]

function #controller:translate_shop

# Modifing template with enabled addons
function #controller:pre_init_shop

# Copy from modded template to teams' shops 
data modify storage minecraft:shop Yellow set from storage minecraft:shop Template
data modify storage minecraft:shop Blue set from storage minecraft:shop Template

# Insert glass to team shops
data modify storage minecraft:shop Yellow append from storage minecraft:shop YellowGlass
data modify storage minecraft:shop Blue append from storage minecraft:shop BlueGlass

function #controller:post_init_shop

data modify storage minecraft:upgrader Yellow set from storage minecraft:upgrader Template
data modify storage minecraft:upgrader Blue set from storage minecraft:upgrader Template

function #controller:init_upgrader

# If enabled, change shulker HP to numbers, instead of hearts
execute if score #NumericalShulkerHP settings matches 1 run data modify storage game:lang Shulker.Health set value ['[{"text":"1","color":"red","bold":true},{"text":"/","color":"gray"},{"text":"7","color":"green"}]', '[{"text":"2","color":"red","bold":true},{"text":"/","color":"gray"},{"text":"7","color":"green"}]', '[{"text":"3","color":"yellow","bold":true},{"text":"/","color":"gray"},{"text":"7","color":"green"}]', '[{"text":"4","color":"yellow","bold":true},{"text":"/","color":"gray"},{"text":"7","color":"green"}]', '[{"text":"5","color":"yellow","bold":true},{"text":"/","color":"gray"},{"text":"7","color":"green"}]', '[{"text":"6","color":"green","bold":true},{"text":"/","color":"gray"},{"text":"7","color":"green"}]', '[{"text":"7","color":"green","bold":true},{"text":"/","color":"gray"},{"text":"7","color":"green"}]']

# Difficulty change. If not set or invalid value, reset to easy
execute if score #Difficulty settings matches 0 run difficulty peaceful
execute unless score #Difficulty settings matches 0 unless score #Difficulty settings matches 2..3 run difficulty easy
execute if score #Difficulty settings matches 2 run difficulty normal
execute if score #Difficulty settings matches 3 run difficulty hard

########################
# Resetting everything #
########################

scoreboard players set #MaxShulkerHealth settings 7
scoreboard players set #KillHeight settings 13000
scoreboard players set #MinFoodLevel settings 19

scoreboard players add #Current GameID 1
# Upgrades
scoreboard players set #Effects yellow 0
scoreboard players set #Effects blue 0

scoreboard players set #Armor yellow 0
scoreboard players set #Armor blue 0

scoreboard players set #Weapon yellow 0
scoreboard players set #Weapon blue 0

scoreboard players set #Forge yellow 0
scoreboard players set #Forge blue 0

scoreboard players set #Souls yellow 0
scoreboard players set #Souls blue 0

# Make sure to clear display objectives
scoreboard objectives setdisplay belowName
scoreboard objectives setdisplay list
scoreboard objectives setdisplay sidebar

# Remove team cages
fill 985 192 1085 991 188 1079 air
fill 1003 192 1085 1009 188 1079 air
# Remove spawn
fill 986 176 1135 1008 190 1158 air

title @a subtitle {"storage": "game:lang","nbt": "Controller.Countdown.StartedSubtitle", "interpret": true}

# Remove old entities
kill @e[tag=Lobby]
kill @e[tag=game]
kill @e[type=item]
# And summon new ones
function #controller:summon

# Schedule functions
function #controller:init_schedule

# Init players
execute as @a[tag=NeedInit] run function #controller:init_player

execute as @a at @s run playsound minecraft:entity.player.levelup master @s ~ ~ ~ 0.8 0.8 1

execute at @e[type=minecraft:area_effect_cloud,tag=Upgrader] run data modify block ~ ~-1 ~ CustomName set from storage game:lang Upgrader.Name
execute at @e[type=minecraft:area_effect_cloud,tag=Shop] run data modify block ~ ~ ~ CustomName set from storage game:lang Shop.Name

#Clear the arena to make sure nothing left
execute as @e[type=area_effect_cloud,limit=1,tag=Fill] at @s run function #game:filler/clear

execute at @e[type=minecraft:area_effect_cloud,tag=Chest] run data modify block ~ ~ ~ Items set value []
#Translate
execute at @e[type=minecraft:area_effect_cloud,tag=Upgrader] unless block ~ ~-1 ~ minecraft:hopper run tellraw @a [{"translate":"[Game] One of your upgrade markers is placed incorrectly! (Must be one block above the hopper)"}]
#Translate
execute at @e[type=minecraft:area_effect_cloud,tag=Chest] unless block ~ ~ ~ minecraft:chest run tellraw @a [{"translate":"[Game] One of your chest markers is placed incorrectly!"}]
#Translate
execute if score #Enabled Debug matches 1 run tellraw @a {"translate":"[Game] Debug mode enabled.\n[Game] To end the game run /function #controller:end"}

team modify yellow nametagVisibility hideForOtherTeams
team modify blue nametagVisibility hideForOtherTeams
team modify player nametagVisibility never

gamerule announceAdvancements false
gamerule commandBlockOutput false
gamerule disableElytraMovementCheck true
gamerule disableRaids true
gamerule doDaylightCycle false
gamerule doEntityDrops false
gamerule doFireTick false
gamerule doImmediateRespawn true
gamerule doInsomnia false
gamerule doLimitedCrafting true
gamerule doMobLoot false
gamerule doMobSpawning false
gamerule doTileDrops true
gamerule doWeatherCycle false
gamerule drowningDamage true
gamerule fallDamage true
gamerule fireDamage true
gamerule keepInventory false
gamerule logAdminCommands false
gamerule maxCommandChainLength 32768
gamerule mobGriefing false
gamerule maxEntityCramming 40
gamerule naturalRegeneration true
gamerule randomTickSpeed 0
gamerule reducedDebugInfo true
execute if score #Enabled Debug matches 1 run gamerule reducedDebugInfo false
gamerule sendCommandFeedback false
execute if score #Enabled Debug matches 1 run gamerule sendCommandFeedback true
gamerule showDeathMessages false
gamerule spawnRadius 1
gamerule spectatorsGenerateChunks false